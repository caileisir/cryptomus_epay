# Cryptomus 加密货币支付插件

<div align="center">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 234 48" width="234" height="48">
  <path fill="#0066FF" d="M69.472 36.676c4.785 0 7.792-3.004 8.613-5.735l-3.896-1.57c-.581 2.048-2.29 3.448-4.614 3.448-2.905 0-5.16-2.185-5.16-5.53s2.255-5.53 5.126-5.53c2.324 0 3.964 1.4 4.545 3.482l3.896-1.536c-.82-2.799-3.828-5.803-8.51-5.803-5.433 0-9.398 4.096-9.398 9.421s4.033 9.353 9.398 9.353m15.283-16.384v-2.014h-4.1v17.988h4.34v-10.24c0-2.423 1.982-4.096 5.126-4.096v-4.062c-2.256 0-4.135.99-5.365 2.424Zm20.287-2.014-5.093 14.507-4.647-14.507h-4.478l6.357 17.988h1.367l-2.46 6.11h4.272l2.323-6.11 6.87-17.988zm16.732-.41c-2.563 0-4.647 1.024-6.049 2.765v-2.355h-4.032v24.098h4.34v-8.021c1.367 1.467 3.281 2.32 5.639 2.32 5.16 0 8.92-4.027 8.92-9.386 0-5.393-3.657-9.42-8.818-9.42Zm-.683 14.985c-3.11 0-5.229-2.287-5.229-5.564s2.119-5.564 5.229-5.564c2.973 0 5.16 2.355 5.16 5.564 0 3.174-2.187 5.564-5.16 5.564m20.226 3.413h2.837v-3.789h-1.982c-1.948 0-3.008-1.126-3.008-3.208v-7.27h4.853v-3.721h-4.716v-4.676h-4.238v2.833c0 1.228-.581 1.843-1.777 1.843h-1.64v3.72h3.144v7.749c0 3.96 2.221 6.52 6.527 6.52Zm13.632.41c5.605 0 9.604-4.028 9.604-9.387 0-5.393-3.999-9.42-9.604-9.42-5.639 0-9.603 4.027-9.603 9.42 0 5.359 3.964 9.387 9.603 9.387m.034-3.857c-3.144 0-5.297-2.321-5.297-5.53 0-3.243 2.153-5.53 5.297-5.53 3.11 0 5.195 2.287 5.195 5.496 0 3.243-2.119 5.564-5.195 5.564m34.004-14.951c-3.041 0-5.092 1.263-6.083 2.936-1.025-1.878-2.837-2.936-5.707-2.936-2.427 0-4.306 1.024-5.434 2.39v-1.98h-4.101v17.954h4.34V25.343c.034-1.706 1.401-3.584 3.862-3.618 2.426 0 3.759 1.81 3.759 4.165v10.342h4.34V25.343c.035-1.672 1.367-3.584 3.862-3.618 2.427 0 3.725 1.843 3.725 4.165v10.342h4.341V25.105c0-4.062-2.427-7.237-6.904-7.237m22.846.41v10.888c0 1.98-1.572 3.619-3.999 3.653-2.426 0-3.964-1.605-3.964-3.926V18.278h-4.34v11.161c0 4.165 2.46 7.237 7.04 7.237 2.324 0 4.272-.99 5.536-2.39v1.98h4.067V18.278zm14.717 18.398c4.511 0 7.45-2.117 7.45-5.7 0-6.588-9.877-4.711-9.877-7.988 0-1.092.855-1.775 2.461-1.775 1.504 0 2.563.649 3.042 2.014l3.793-1.468c-.752-2.457-3.281-3.89-6.767-3.89-4.237 0-6.972 2.047-6.972 5.324 0 6.178 9.877 4.54 9.877 8.09 0 1.263-1.093 1.98-2.836 1.98-2.188 0-3.589-.99-4.101-2.663l-3.794 1.468c.991 3.038 3.828 4.608 7.724 4.608M43.535 11.345 25.277.817a2.69 2.69 0 0 0-2.675 0L4.344 11.345a2.68 2.68 0 0 0-1.34 2.317v21.055c0 .951.513 1.837 1.34 2.317l18.258 10.528a2.67 2.67 0 0 0 1.34.356c.471 0 .933-.125 1.34-.356L43.54 37.034a2.68 2.68 0 0 0 1.34-2.316V13.662c0-.95-.513-1.837-1.34-2.317zM24.353 22.884a.83.83 0 0 1-.827 0L5.776 12.65l17.75-10.23a.85.85 0 0 1 .827 0l17.75 10.232zm-1.751 1.596q.194.112.416.19v20.99L5.268 35.433a.83.83 0 0 1-.416-.715v-20.47z"></path>
</svg>
</div>

这是一个基于彩虹易支付的加密货币Cryptomus支付插件，支持接收比特币、以太坊、USDT等多种加密货币支付。

## 功能特点

- 支持多种加密货币支付（BTC、ETH、USDT等）
- 支持多种法定货币计价（CNY、USD、EUR）
- 实时汇率转换
- 可配置订单有效期
- 支持多次支付同一订单
- 完整的支付流程和回调机制
- 基于官方SDK，安全可靠

## 安装步骤

### 1. 上传文件

将插件文件夹上传到您的支付系统中的插件目录。

```
assets/
└──icon
     ├── crypto.ico   # logo
plugins/
└── cryptomus/
    ├── cryptomus_plugin.php    # 主插件文件
    ├── inc/
    │   ├── cryptomus.config.php  # 配置文件
    │   └── cryptomus/           # SDK目录
    │       └── composer.json    # Composer配置
    └── README.md               # 说明文档
```

### 2. 安装依赖

插件依赖于Cryptomus官方PHP SDK，您需要使用Composer安装依赖：

```bash
cd plugins/cryptomus/inc/cryptomus
composer install
```

这将创建一个`vendor`目录并安装所需的依赖项。

### 安装教程
1.后台菜单-支付接口-支付插件 **刷新**

2.后台菜单-支付接口-支付方式 **新增支付 调用值**`crypto`

3.后台菜单-支付接口-支付通道 **新增支付** 选择`刚刚添加的支付方式`

### 3. 配置Cryptomus商户信息

在支付系统后台添加新的支付方式，选择"Cryptomus加密货币支付"，并填写以下信息：

* **API地址**: 通常为 `https://api.cryptomus.com/v1/`
* **商户ID**: 您的Cryptomus商户ID，可在Cryptomus商户后台获取
* **API密钥**: 您的Cryptomus API密钥，可在Cryptomus商户后台获取
* **默认货币**: 选择人民币(CNY)、美元(USD)或欧元(EUR)
* **订单有效期**: 设置支付订单的有效期，超时未支付将自动关闭
* **允许多次支付**: 是否允许用户多次支付同一订单

### 4. 测试支付

完成配置后，建议进行一次完整的支付测试：

1. 在您的网站创建一个小额订单
2. 选择Cryptomus作为支付方式
3. 完成支付流程
4. 验证订单状态是否正确更新

## 多币种支付说明

### 支持的法定货币

本插件支持使用多种法定货币作为计价货币：

- **人民币(CNY)** - 默认选项
- **美元(USD)**
- **欧元(EUR)**

您可以在后台插件配置中选择适合您业务的默认货币。

### 支持的加密货币

该插件支持Cryptomus平台支持的所有加密货币，包括但不限于：

* Bitcoin (BTC)
* Ethereum (ETH)
* Tether (USDT)
* USD Coin (USDC)
* Binance Coin (BNB)
* Dogecoin (DOGE)
* 以及更多...

### 汇率说明

当用户进行支付时，Cryptomus会使用实时汇率将法定货币金额转换为所选加密货币的等值金额。请注意：

1. 汇率由Cryptomus提供并实时更新
2. 由于加密货币价格波动，转换后的加密货币金额可能会略有变化
3. 支付确认时使用的是创建支付时的汇率，不受后续价格波动影响

## 故障排除

如果您在安装或使用过程中遇到问题，请检查：

1. **依赖项安装**：确保Composer依赖安装成功
2. **API凭据**：验证API密钥和商户ID是否正确
3. **回调通知**：检查服务器防火墙是否允许Cryptomus的回调请求
4. **PHP版本**：确保PHP版本不低于7.2，并启用了必要的扩展（json, bcmath, mbstring）

## 常见问题

### 1. 支付成功但订单未更新？

请检查异步通知URL是否能够正常访问，确保您的服务器能够接收到Cryptomus的回调请求。

### 2. 如何查看支付日志？

支付过程中的日志记录在您支付系统的日志目录中，可以帮助排查问题。

### 3. 支付页面无法跳转？

请确认您的API密钥和商户ID填写正确，并且账户已激活。

### 4. 如何为不同客户群体选择合适的默认货币？

- 如果主要面向中国客户，建议使用人民币(CNY)
- 如果面向全球客户，建议使用美元(USD)
- 如果主要面向欧洲客户，建议使用欧元(EUR)

### 5. 支持多少种加密货币？

插件支持Cryptomus平台上所有可用的加密货币，用户可以在支付页面选择他们偏好的加密货币进行支付。

## 退款处理

如需处理退款，请注意：

1. 退款将以原始支付的加密货币进行
2. 退款金额将根据支付时的汇率计算
3. 由于加密货币价格波动，退款时的法定货币等值可能与原始支付金额不同

## 技术要求

- PHP 7.2+
- Composer
- PHP扩展：json, bcmath, mbstring
- HTTPS支持

## 安全建议

为确保支付安全，请：

1. 定期更新API密钥
2. 不要在公共场所泄露您的API凭据
3. 启用HTTPS以保护数据传输
4. 定期检查支付日志，及时发现异常情况

---

© 2025 Cryptomus Payment Plugin
